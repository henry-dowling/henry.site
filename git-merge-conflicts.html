<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>How Git decides when there's a merge conflict ‚Äì Henry Dowling</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/jpeg" href="favicon.jpg">
  <style>
    body {
      line-height: 1.4;
      font-size: 16px;
      padding: 0 10px;
      margin: 50px auto;
      max-width: 650px;
    }
    #maincontent {
      max-width: 42em;
      margin: 15 auto;
    }
    pre {
      background: #f7f7f7;
      padding: 10px;
      overflow: auto;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
    }
    .code-comparison {
      display: flex;
      gap: 20px;
      margin: 20px 0;
    }
    .code-comparison pre {
      flex: 1;
      margin: 0;
    }
    .code-block {
      display: flex;
      flex-direction: column;
    }
    .code-caption {
      font-size: 0.9em;
      font-weight: 600;
      color: #666;
      margin-bottom: 8px;
      text-align: center;
    }
    @media (max-width: 768px) {
      .code-comparison {
        flex-direction: column;
        gap: 10px;
      }
    }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 0.85em; }
    .blue-text { color: blue; }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
</head>
<body>
  <header>
    <h2><a href="index.html" style="color: inherit; text-decoration: none;">Henry Dowling</a>'s <a href="blog.html">Blog</a></h2>
  </header>
  <main>
    <h2>How Git decides when there's a merge conflict</h2>
    <p style="color:#666; margin-top:-10px;">October 18, 2025</p>

    <p>After working through a merge conflict, Sam asked me ‚Äúhow does Git decide when there‚Äôs a merge conflict versus just automerging anyway?‚Äù I was annoyed that I couldn‚Äôt give a simple answer, so I looked it up and here it is:</p>

    <h3>The basics</h3>
    <p>When you merge two branches, Git performs a three-way merge. This just means it constructs a new merge-specific working tree by walking three trees in parallel: branch A, branch B, and their common ancestor (the base). Whenever it reaches a file where the blob hashes differ between any of the three trees, it applies this rule of thumb:</p>
    <p>For every line in the base... </p> 
    <ul>
      <li><strong>If exclusively A or B changes the line</strong>, keep that side‚Äôs change (no conflict).</li>
      <li><strong>If both A and B change the line</strong>, declare a merge conflict.</li>
    </ul>

    <p>Here's an example where we keep A's change (left) versus where Git declares a conflict (right):</p>
    <div class="code-comparison">
      <div class="code-block">
        <div class="code-caption">Take A's changes</div>
        <pre><code class="language-python"># Base
print("hello world")
print("A")
print("B")
print("C")

# A
print("hello world")
<mark>print("DOG")</mark>
print("B")
print("C")

# B
print("hello world")
print("A")
print("B")
print("C")
</code></pre>
      </div>
      <div class="code-block">
        <div class="code-caption">Merge conflict :(</div>
        <pre><code class="language-python"># Base
print("hello world")
print("A")
print("B")
print("C")

# A
print("hello world")
<mark>print("DOG")</mark>
print("B")
print("C")

# B
print("hello world")
<mark>print("CAT")</mark>
print("B")
print("C")
</code></pre>
      </div>
    </div>

    <p>And that's it! üéâ Pretty simple. </p>

    <b> But wait, what about adding new lines? Deleting lines? Moving lines?</b>
    <p> Okay, I‚Äôve been slightly lying to you so far. The actual thing that git checks isn‚Äôt whether two edits are made to the <em>same line</em>, but whether the patches A and B have any <mark><em>overlapping hunks</em></mark>. </p>

    <h3>Hunks</h3>
    <p>Now we need to introduce the concept of <em>hunks</em>. Hunks actually come from <em>diff algorithms</em>, not Git itself. By default Git uses <a href=https://blog.jcoglan.com/2017/02/12/the-myers-diff-algorithm-part-1/>Myers' algorithm</a>.<sup id="fnref1"><a href="#fn1">1</a></sup></p> 
    <p>See <a href=https://www.gnu.org/software/diffutils/manual/html_node/Hunks.html>here</a> for a great explanation of what a hunk is. A <em>hunk</em> is a contiguous group of changed lines in a diff, optionally surrounded by some context lines for human readability.</p>

    <p>We can write the diff between any two files as:
        
        <ul>
            <li>
              <strong> Diff = Blocks where the two files are the same + Blocks where the two files differ </strong>
            </li>
          </ul>
        
    
    We call the second term‚Äîeach of the discrete blocks where the files differ‚Äî<em>hunks</em>. The example below has two hunks: </p>

    <div class="code-comparison">
      <div class="code-block">
        <div class="code-caption">File A</div>
        <pre><code class="language-python">print("A")
<mark>print("DOG")</mark>
print("B")
<mark>print("RED")</mark>
print("D")</code></pre>
      </div>
      <div class="code-block">
        <div class="code-caption">File B</div>
        <pre><code class="language-python">print("A")
<mark>print("CAT")</mark>
print("B")
<mark>print("BLUE")</mark>
print("D")</code></pre>
      </div>
    </div>
    
    <div class="code-block">
      <div class="code-caption">Diff</div>
      <pre><code class="language-plaintext">Same: print("A")
Hunk 1: { <mark>print("DOG")</mark> ‚Üî <mark>print("CAT")</mark> }
Same: print("B")
Hunk 2: { <mark>print("RED")</mark> ‚Üî <mark>print("BLUE")</mark> }
Same: print("D")</code></pre>
    </div>

    <h3>Hunks depend on diff algorithm</h3>
    <p>I said earlier that hunks come from diff algorithms. Here's something surprising: two different diff algorithms can yield <u>two different sets of hunks</u> for a given set of files.<sup id="fnref2"><a href="#fn2">2</a></sup></p>

    <p>Suppose the file F contains the three lines 'a', 'b', 'c', and the file G contains the same three lines in reverse order: 'c', 'b', 'a'. If diff finds the line 'c' as common, then the command 'diff F G' produces this output:</p>
    <div class="code-block">
      <div class="code-caption">Diff output (common line 'c')</div>
      <pre><code class="language-diff">1,2d0
&lt; a
&lt; b
3a2,3
&gt; b
&gt; a
</code></pre>
    </div>
    <p>But if diff notices the common line 'b' instead, it produces this output:</p>
    <div class="code-block">
      <div class="code-caption">Diff output (common line 'b')</div>
      <pre><code class="language-diff">1c1
&lt; a
---
&gt; c
3c3
&lt; c
---
&gt; a
    </code></pre>
    </div>

    <p>There are many different ways for a diff algorithm to decide on which hunks to use to represent the diff between two files, and it's up to the diff algorithm to make hunks minimal and readable to make life easier for the reviewer.<sup id="fnref3"><a href="#fn3">3</a></sup></p>

    <h3>Hunks in Git‚Äôs merge algorithm</h3>

    <p>Okay, great. Now that we understand the concept of hunks, we can give the <em>real</em> way the Git decides when there's a merge conflict:</p>
    <ol>
      <li>It applies changes <code>base ‚Üí A</code> and <code>base ‚Üí B</code>.</li>
      <li>It checks to see if the patches <code>base ‚Üí A</code> and <code>base ‚Üí B</code> have any overlapping hunks. If there are, that's a merge conflict. </ol>
    <p>Here's an example:</p>

    <div class="code-comparison">
      <div class="code-block">
        <div class="code-caption">Patch A</div>
        <pre><code class="language-diff"># Base
print("hello world")
print("A")
print("B")
print("C")

# Commit A
print("hello world")
<mark>print("DOG")</mark>
print("B")
print("C")

diff A (ie `git diff base A`):
<span class="blue-text">@@ -1,4 +1,5 @@</span>
 print("hello world")
 print("A")
+<mark>print("DOG")</mark>
 print("B")
 print("C")
 \ No newline at end of file
</code></pre>
      </div>
      <div class="code-block">
        <div class="code-caption">Patch B</div>
        <pre><code class="language-diff"># Base
print("hello world")
print("A")
print("B")
print("C")

# Commit B
print("hello world")
<mark>print("CAT")</mark>
print("B")
print("C")

diff B (ie `git diff base B`):
<span class="blue-text">@@ -1,4 +1,5 @@</span>
 print("hello world")
 print("A")
+<mark>print("CAT")</mark>
 print("B")
 print("C")
 \ No newline at end of file
</code></pre>
      </div>
    </div>

    <p>Here the hunks overlap, so Git reports a conflict.</p>

    <h3>Wait, but what does it mean for hunks to overlap?</h3>

    <p>Each hunk's length can be measured by (old_start, old_length, new_start, new_length). That's what notation like <span class="blue-text">@@ -1,4 +1,5 @@</span> is that you see in git diff! (Here, we see that the lengths are 4 and 5 rather than 0 and 1 because git includes 2 lines of context on either side for human readability)</p>

    <p>So, hunks A and B overlap iff the ranges (a.old_start, a.old_length) (b.old_start, b.old_length) intersect. <u>Why use old rather than new?</u> Because the base file is a convenient common reference point between A and B. This is one of the fundamental reasons why using a 3-way merge is helpful.</p>

    <h3>Aside: contextual lines</h3>
    
    <p>Okay, I was lying to you again. Remember when I said "hunks A and B overlap if the ranges (a.old_start, a.old_length) (b.old_start, b.old_length) intersect"? This is not quite true. The window we see when we run git diff includes 2 lines of context on either side for human readability.<sup id="fnref4"><a href="#fn4">4</a></sup> The context lines are not considered as part of the hunks for the purposes of determining merge conflicts.</p>

    <p>So, consider these diffs:</p>

    <pre><code><span class="blue-text">@@ -1,4 +1,5 @@</span> 
print("hello world") 
print("A") 
+print("DOG") 
print("B") 
print("C") 
\ No newline at end of file 

<span class="blue-text">@@ -1,4 +1,5 @@</span> 
print("hello world") 
print("A") 
print("B") 
+print("CAT") 
print("C") 
\ No newline at end of file</code></pre>

    <p>And this base:</p>
    <pre><code>print("hello world") 
print("A") 
print("B") 
print("C")</code></pre>

    <p>We can make this merge with no conflicts, since the Git-readable hunks do not intersect, although when you include the surrounding context that Git adds for human readability, it appears that they do! DOG clearly appears between A and B whereas CAT appears between B and C.</p>
    
    <h3>Conclusion</h3>
    <p>So the real algorithm is this:<br>
    <ul>
        <li> It applies changes base‚ÜíA and base‚ÜíB</li>
        <li> It checks to see if the patches base‚ÜíA and base‚ÜíB have any overlapping hunks. If they do, then those lines are marked as a merge conflict and manually added to the merge tree.</li>
    </ul>
    
    <p><u>And that's it!</u> üéâ This is how Git can tell if there is a merge conflict. Except for a number of special cases:</p>
    <ul>
        <li>File rename conflicts </li>
        <li>Deleting + editing a file</li>
        <li>Binary file conflicts</li>
        <li>Directory / file name conflicts</li>
        <li>Whitespace-only conlicts</li>
        <li>...and many more</li>
    </ul>


    <p>These are less interesting so I won't cover them.</p>

    <hr>
    <section id="footnotes" aria-label="Footnotes">
      <ol style="font-size:0.95em; color:#555; padding-left: 1.2em; margin-top: 1em;">
        <li id="fn1">If you're a nerd you can manually choose which diff algorithm you want Git to use in .gitattributes. <a href="#fnref1" aria-label="Back to content">‚Ü©</a></li>
        <li id="fn2">This example is taken from <a href="https://www.gnu.org/software/diffutils/manual/html_node/Hunks.html">the GNU diffutils docs</a>. <a href="#fnref2" aria-label="Back to content">‚Ü©</a></li>
        <li id="fn3">This has implications for codebase analytics too- your PR that GitHub says was +124 -28 lines may not actually be +124 -28 when using a different diff algorithm! <a href="#fnref3" aria-label="Back to content">‚Ü©</a></li>
        <li id="fn4">You can configure the number of context lines globally with <code>git config --global diff.context &lt;number&gt;</code> or for individual commands using <code>git diff -U&lt;number&gt;</code>. <a href="#fnref4" aria-label="Back to content">‚Ü©</a></li>
      </ol>
    </section>

  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/diff.min.js" defer></script>
  <script>document.addEventListener('DOMContentLoaded',function(){ if (window.hljs) { hljs.highlightAll(); } });</script>
</body>
</html>

